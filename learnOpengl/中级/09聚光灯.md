# 理论

![输入图片说明](/imgs/2024-11-27/ZHfFrb5bSOMsbysr.png)

![输入图片说明](/imgs/2024-11-27/sH5oH5jGIrpeHnfz.png)

# 实现
目标：
1. 加入SpotLight类
2. 编写聚光灯效果的shader代码
3. 编写聚光灯效果的render函数
4. 构建试验场景

### 目标一
创建`spotLight.h`和`spotLight.cpp`，
在`spotLight.h`中，需要定义光源方向和可视的角度
```
#pragma once
#include "light.h"
#include "../object.h"
class SpotLight :public Light, public Object {
public:
	SpotLight();
	~SpotLight();
public:
	glm::vec3 mTargetDirection{ -1.0f };
	float mVisibleAngle{ 0.0f };
};
```
### 目标二
修改`phong.frag`，`vertex`没啥好改的
添加`targetDirection`，是聚光灯直射的中心线，`visibleAngle`是可见角的范围
```
...
//光源参数
uniform vec3 lightPosition;
uniform vec3 targetDirection;
uniform float visibleAngle;
uniform vec3 lightColor;
...
void main()
{
    ...
    vec3 viewDir = normalize(worldPosition - cameraPosition);
    vec3 targetDirN = normalize(targetDirection);

    //计算spotLight的照射范围
    float cTheta = dot(lightDirN, targetDirN);
    float cVisible = cos(visibleAngle);
    float spotFlag = step(cVisible, cTheta);

    ...
    vec3 finalColor = (diffuseColor + specularColor) * spotFlag + ambientColor;


    FragColor = vec4(finalColor, 1.0);
}
```
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTEzMjE3ODYwMDQsLTIwNTE3Mjc1ODQsLT
E0NzUxMjU5NTFdfQ==
-->