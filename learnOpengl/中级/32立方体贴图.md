![输入图片说明](/imgs/2025-02-15/1kcIg0ADvqMmLevC.png)

# 制作蒙鼓人
我们先制作一个演示立方体，长度为`1`是为了对应`uv`
```cpp
void prepare() {
	renderer = new Renderer();
	scene = new Scene();

	framebuffer = new Framebuffer(WIDTH, HEIGHT);

	auto boxGeo = Geometry::createBox(1.0f);
	auto boxMat = new PhongMaterial();
	boxMat->mDiffuse = new Texture("assets/textures/grass.jpg", 0);
	auto boxMesh = new Mesh(boxGeo, boxMat);
	scene->addChild(boxMesh);
	...
}

```
创建`cube.vert`
```glsl
#version 460 core
layout (location = 0) in vec3 aPos;
layout (location = 1) in vec2 aUV;

out vec2 uv;

uniform mat4 modelMatrix;
uniform mat4 viewMatrix;
uniform mat4 projectionMatrix;


void main()
{
	vec4 transformPosition = vec4(aPos, 1.0);

	transformPosition = modelMatrix * transformPosition;


	gl_Position = projectionMatrix * viewMatrix * transformPosition;
	
	uv = aUV;
}
```
和`cube.frag`
```glsl
#version 460 core
out vec4 FragColor;

in vec2 uv;

uniform sampler2D diffuse;

void main()
{

	FragColor = vec4(texture(diffuse, uv).rgb, 1.0);
}
```
创建`cubeMaterial.h`
```cpp
#pragma once
#include "material.h"

class CubeMaterial :public Material {
public:
	CubeMaterial();
	~CubeMaterial();
public:
	Texture* mDiffuse{ nullptr };
};
```
以上`mDiffuse`和`shader`中的`diffuse`都只是为了演示方便，后续会删除

和`cubeMaterial.cpp`
```cpp
#include "cubeMaterial.h"

CubeMaterial::CubeMaterial() {
	mType = MaterialType::CubeMaterial;
}

CubeMaterial::~CubeMaterial() {

}
```
然后在`material.h `枚举中添加对应枚举元素
```cpp
enum class MaterialType {
	PhongMaterial,
	WhiteMaterial,
	DepthMaterial,
	OpacityMaskMaterial,
	ScreenMaterial,
	CubeMaterial
};
```
然后去到`render.h`，添加`shader`对象
```cpp
private:
	//生成多种不同的shader对象
	//根据材质类型的不同，挑选使用哪一个shader对象
	Shader* mPhongShader{ nullptr };
	Shader* mWhiteShader{ nullptr };
	Shader* mDepthShader{ nullptr };
	Shader* mOpacityMaskShader{ nullptr };
	Shader* mScreenShader{ nullptr };
	Shader* mCubeShader{ nullptr };
```
并到`render.cpp`声明并且完善`pickShader`函数
```cpp
Renderer::Renderer() {
	mPhongShader = new Shader("assets/shaders/phong.vert", "assets/shaders/phong.frag");
	mWhiteShader = new Shader("assets/shaders/white.vert", "assets/shaders/white.frag");
	mDepthShader = new Shader("assets/shaders/depth.vert", "assets/shaders/depth.frag");
	mOpacityMaskShader = new Shader("assets/shaders/phongOpacityMask.vert", "assets/shaders/phongOpacityMask.frag");
	mScreenShader = new Shader("assets/shaders/screen.vert", "assets/shaders/screen.frag");
	mCubeShader = new Shader("assets/shaders/cube.vert", "assets/shaders/cube.frag");
}
```
```cpp
Shader* Renderer::pickShader(MaterialType type) {
	Shader* result = nullptr;

	switch (type) {
	...
	case MaterialType::CubeMaterial:
		result = mCubeShader;
		break;
	...
	}

	return result;
}
```
<!--stackedit_data:
eyJoaXN0b3J5IjpbNDQ5NjMxMDEyLDUyNzUyNjUxNCwtMTc3NT
U4NjU3NSwyMjc0NzcxMDFdfQ==
-->