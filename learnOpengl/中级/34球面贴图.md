![输入图片说明](/imgs/2025-02-17/fGoLSbjlRnfQ6WYq.png)

![输入图片说明](/imgs/2025-02-17/fX6qU701Q758Z7Ws.png)

![输入图片说明](/imgs/2025-02-17/PWTUh1Xm8t8H1wJ4.png)

![输入图片说明](/imgs/2025-02-17/0FOX0yF0yxYpGtcW.png)

这里的`atan`会输入两个值，`OpenGL`提供的函数可以判断出是哪个`theta`角，因为同一个tan值可能会对应两个角度，如下这个情况

![输入图片说明](/imgs/2025-02-17/eSvPgvgYHZRwSGXT.png)

![输入图片说明](/imgs/2025-02-17/jpPse2kwZICsVOts.png)

![输入图片说明](/imgs/2025-02-17/ykiayiYFtkp65pRO.png)

# 代码实验
## 更改CubeShader，输入球形贴图，计算采样uv
`cube.vert`还是就和原来一样即可
```glsl
#version 460 core
layout (location = 0) in vec3 aPos;
out vec3 uvw;
uniform mat4 modelMatrix;
uniform mat4 viewMatrix;
uniform mat4 projectionMatrix;

void main()
{
	vec4 transformPosition = vec4(aPos, 1.0);
	transformPosition = modelMatrix * transformPosition;
	gl_Position = projectionMatrix * viewMatrix * transformPosition
	gl_Position = gl_Position.xyww;
	uvw = aPos;
}
```
需要做修改的是`cube.frag`，
```glsl
#version 460 core
out vec4 FragColor;

in vec3 uvw;

//uniform samplerCube cubeSampler;
uniform sampler2D sphericalSampler;

const float PI = 3.1415926535987932384626433832795;

vec2  uvwToUv(vec3 uvwN){
	float  phi = asin(uvwN.y);
	float theta = atan(uvwN.z, uvwN.x);
	float u = theta / (2.0 * PI) + 0.5;
	float v = phi / PI + 0.5;
	return vec2(u, v);
}

void main()
{
	vec3 uvwN = normalize(uvw);
	vec2 uv = uvwToUv(uvwN);
	FragColor = texture(sphericalSampler, uv);
}
```
## 更改实验程序

<!--stackedit_data:
eyJoaXN0b3J5IjpbMTExMzQyNzI0NiwtMTY3MTk1Mzc2MiwxOT
ExMjEyNzQxLDg3NDc1MzgxMiwtMjEyNjc2ODYxMSwyMzM4MzI4
MTMsMTQ1MTI2NDA3N119
-->