# ç†è®ºè®¾è®¡
å‰å‘æ¸²æŸ“æ˜¯ï¼š**æ¯æ¸²æŸ“ä¸€ä¸ªç‰©ä½“ â†’ è®¡ç®—å®Œæ•´å…‰ç…§ â†’ è¾“å‡ºé¢œè‰²**
å»¶è¿Ÿæ¸²æŸ“æ˜¯ï¼š

1.  ç¬¬ä¸€æ­¥ï¼ˆGBuffer Passï¼‰ï¼šæ¸²æŸ“æ‰€æœ‰ç‰©ä½“ï¼ŒæŠŠå‡ ä½•ä¿¡æ¯å†™å…¥å¤šä¸ªç¼“å†²ï¼ˆGBufferï¼‰ï¼š
    ä½ç½® / æ³•çº¿ / æ¼«åå°„é¢œè‰² / é•œé¢åå°„å‚æ•° ç­‰
        
2.  ç¬¬äºŒæ­¥ï¼ˆLighting Passï¼‰ï¼šéå†å…‰æºï¼Œ**åœ¨å±å¹•ç©ºé—´**ä¸­è¿›è¡Œå…‰ç…§è®¡ç®—ï¼Œç”Ÿæˆæœ€ç»ˆé¢œè‰²

å¼€å§‹è®¾è®¡
åœ¨åŸæœ¬å‰å‘æ¸²æŸ“çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬éœ€è¦
# æ”¹é€ æµç¨‹
## 1. åˆ›å»º GBuffer ç»“æ„

éœ€è¦åˆ›å»ºå¤šä¸ª FBO é¢œè‰²é™„ä»¶ï¼ˆGBufferï¼‰ï¼š
```cpp
// åˆ›å»º FBO
glGenFramebuffers(1, &gBufferFBO);
glBindFramebuffer(GL_FRAMEBUFFER, gBufferFBO);

// GBuffer åˆ†é‡
- Albedo + Specularï¼ˆRGBAï¼‰
- Normalï¼ˆRGB æˆ–ç¼–ç æˆ 2 åˆ†é‡ï¼‰
- Positionï¼ˆæˆ–æ·±åº¦ï¼‰

// æ¯ä¸ªä½¿ç”¨ glTexImage2D åˆ›å»ºå¹¶ attach åˆ° GL_COLOR_ATTACHMENTi
glFramebufferTexture2D(...);
```

å¯ä»¥è§£é‡Šä¸€ä¸‹è¿™ä¸ªå¤šä¸ªé¢œè‰²é™„ä»¶
### ä¸ºä»€ä¹ˆè¦å¤šä¸ª Color Attachmentï¼Ÿ

**å»¶è¿Ÿæ¸²æŸ“æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå…ˆæ”¶é›†â€œæè´¨ + å‡ ä½•ä¿¡æ¯â€ï¼Œç»Ÿä¸€åšå…‰ç…§**ã€‚

è¿™äº›ä¿¡æ¯æ— æ³•å¡è¿›ä¸€ä¸ªé¢œè‰²è¾“å‡ºï¼ˆColor Attachmentï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦**å¤šä¸ªé¢œè‰²ç¼“å†²ï¼ˆGBufferï¼‰**ï¼Œæ¯ä¸ªç”¨æ¥å­˜å‚¨ä¸åŒçš„ä¿¡æ¯ï¼š

`GL_COLOR_ATTACHMENT0`ï¼šAlbedo + Specularï¼Œè¡¨é¢é¢œè‰²ã€æè´¨å‚æ•°

`GL_COLOR_ATTACHMENT1`ï¼šæ³•çº¿ï¼ˆNormalï¼‰ï¼Œå…‰ç…§æ–¹å‘è®¡ç®—

`GL_COLOR_ATTACHMENT2`ï¼šä¸–ç•Œåæ ‡ / è§†ç©ºé—´ä½ç½®ï¼Œè®¡ç®—å…‰ç…§æ–¹å‘ã€è·ç¦»è¡°å‡

`GL_DEPTH_ATTACHMENT`ï¼šæ·±åº¦å€¼ï¼Œå…‰ç…§è®¡ç®—æ—¶è¿˜åŸä½ç½® / å±å¹•ç©ºé—´è£å‰ª

ğŸ‘‰ æ‰€ä»¥ï¼š
> â€œæ³•çº¿â€ã€â€œUVâ€ã€â€œé¢œè‰²â€ç­‰éƒ½è¢«**è¾“å‡ºåˆ°ä¸åŒçš„é¢œè‰² attachment ä¸­â€ï¼Œæ”¾åœ¨åŒä¸€ä¸ª FBO é‡Œã€‚

### æ˜¯ä¸æ˜¯å¤šä¸ª FBOï¼Ÿç­”æ¡ˆæ˜¯ âŒ **ä¸€ä¸ª FBO + å¤šä¸ª Color Attachment**

ä½ åªéœ€è¦ä¸€ä¸ª FBOï¼Œä½†ç»‘å®šå¤šä¸ªçº¹ç†ï¼š
```cpp
glGenFramebuffers(1, &gBufferFBO);
glBindFramebuffer(GL_FRAMEBUFFER, gBufferFBO);

// åˆ›å»ºå¤šä¸ªé¢œè‰² attachment çº¹ç†
glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, ..., gAlbedoTexture);
glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT1, ..., gNormalTexture);
glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT2, ..., gPositionTexture);

// æ·±åº¦ç¼“å†²
glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, ..., depthBuffer);

// å‘Šè¯‰ OpenGL ä½ ä¼šå†™å…¥è¿™å‡ ä¸ªé¢œè‰²é™„ä»¶
GLenum attachments[3] = {
  GL_COLOR_ATTACHMENT0,
  GL_COLOR_ATTACHMENT1,
  GL_COLOR_ATTACHMENT2
};
glDrawBuffers(3, attachments);
```
æ‰€ä»¥ï¼š
-   **ä¸€ä¸ª FBO**ï¼šæ•´åˆå¤šä¸ª attachment
-   **å¤šä¸ª Attachmentï¼ˆGBufferï¼‰**ï¼šç”¨äº Geometry Pass æ—¶è¾“å‡ºå¤šä¸ªæ•°æ®é€šé“
-   **æ¯ä¸ª GBuffer æ˜¯ä¸€ä¸ªè´´å›¾ï¼ˆTextureï¼‰**ï¼Œä¹‹å Lighting Pass ä¼šç”¨å®ƒä»¬ä½œä¸ºè¾“å…¥

## 2. å®ç° Geometry Passï¼ˆå†™å…¥ GBufferï¼‰

-   ä½¿ç”¨ä¸€ä¸ªæ–°çš„ Shaderï¼ˆ`geometry_pass.vert / frag`ï¼‰
    
-   è¾“å‡ºï¼š
```cpp
out vec4 gAlbedoSpec;
out vec3 gNormal;
out vec3 gPosition;

```
<!--stackedit_data:
eyJoaXN0b3J5IjpbNzY3NjM4MjA0LDUwMzk1OTYzMV19
-->