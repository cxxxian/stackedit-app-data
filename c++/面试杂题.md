这样是对的吗
```cpp
char* a = "abcde";
char b = "abcdef";
std::memcpy(a, b, 5);
```
其实是不对的，因为
`char* a = "abcde";`
`"abcde"` 是一个 **字符串常量**（存放在只读存储区，通常是 `.rodata` 段）。
在现代 C++ 中，`"abcde"` 的类型是 `const char[6]`，会退化成 `const char*`。
所以严格来说，应该写成：
 `const char* a = "abcde";`
你写成 `char* a` 在 C++11 之后其实会报 **警告/错误**，因为你试图把 `const char*` 转成 `char*`。
如果强行编译通过，`a` 指向的区域是只读的，对它写会导致 **未定义行为（通常是段错误 segfault）**。

如果要实现以上的效果
需要这样声明`a`
```cpp
char* a = new char[6];  // 可写
```

# c++生命周期问题
c++不同变量的作用域和生命周期，大概了解哪一些，
new出来的生命周期的变量是怎么样的，
new出来的变量没有手动释放会怎么样

## 一、作用域（Scope）
作用域决定**变量能被访问的范围**，一般分为：
### 1. 局部作用域（Local Scope）
-   定义在函数或语句块 `{}` 中的变量。
-   进入 `{}` 时创建，离开 `{}` 时销毁。
```cpp
void foo() {
    int a = 10; // 局部变量
} // 离开函数，a 被销毁
```
### 2. 全局作用域（Global Scope）
-   定义在所有函数外部的变量。
-   程序启动时创建，程序结束时销毁。
```cpp
int g = 5; // 全局变量
int main() { g++; }
```
### 3. 静态作用域（Static Scope）
-   用 `static` 修饰的变量，即使定义在函数内，也会**在整个程序期间都存在**，但**只在定义的作用域内可见**。
```cpp
void foo() {
    static int counter = 0; // 只会初始化一次
    counter++;
}
```
### 4. 类作用域（Class Scope）
-   类的成员变量、函数的作用域。
```cpp
class MyClass {
    int x; // 类成员作用域
};
```

![输入图片说明](/imgs/2025-11-02/lgqlQYMMSQupPcAi.png)

## 三、`new` 出来的变量

当你写：
```cpp
int* p = new int(5);
```
它的行为是：
-   `new` 从**堆内存**中分配空间；
-   调用类型的**构造函数**（如果有）；
-   返回一个**指向该内存的指针**。
所以：
-   `p` 是一个局部变量（存在栈上）；
-   `*p` 指向的对象存在堆上；
-   这个堆上对象的生命周期**不会随着作用域结束而自动释放**。

## 四、如果 `new` 出来的变量没有手动释放会怎样？
```cpp
void foo() {
    int* p = new int(10);
} // 函数结束，但没有 delete
```
结果：
-   `p`（指针）离开作用域被销毁；
-   但堆上的那块内存（`new int(10)`）**仍然存在**；
-   导致 **内存泄漏（memory leak）**。

内存泄漏的危害：
-   程序长期运行会越来越占内存；
-   资源无法回收；
-   在嵌入式或游戏引擎中可能导致崩溃。
- 
## 五、正确做法

要用 `delete` 手动释放：
```cpp
int* p = new int(5); 
delete p; p = nullptr; // 防止悬空指针
```

数组要用 `delete[]`：
```cpp
int* arr = new int[10]; 
delete[] arr;
```
## 六、现代 C++ 推荐做法：智能指针

不建议手动 `new` 和 `delete`，容易出错。  
建议使用 **智能指针**：
```cpp
#include <memory> 
void foo() {     
	auto p = std::make_unique<int>(5);   // 自动释放     
	auto q = std::make_shared<int>(10);  // 引用计数释放 
} // 离开作用域自动析构，安全无泄漏
```
<!--stackedit_data:
eyJoaXN0b3J5IjpbMjEwNTU4MTk5OSwxOTMxMzU5NzMyXX0=
-->